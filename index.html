<DOCTYPE html>
<html>
	<head>
		<title>Wat</title>
		<script type="text/javascript" src="http://canvg.googlecode.com/svn/trunk/rgbcolor.js"></script>
		<script type="text/javascript" src="http://canvg.googlecode.com/svn/trunk/StackBlur.js"></script>
		<script type="text/javascript" src="http://canvg.googlecode.com/svn/trunk/canvg.js"></script>
		<style>
			html {
				background: #FFFC9B;
			}
			canvas {
			}
			#wrapper {
				margin: 0px auto;
				width: 1200px;
			}
		</style>
	</head>

	<body>
		<div id="wrapper">
			<canvas id="draw" width="1200" height="600"></canvas>
		</div>
		<script type="text/javascript">

			var wat = '<svg    xmlns:dc="http://purl.org/dc/elements/1.1/"    xmlns:cc="http://creativecommons.org/ns#"    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"    xmlns:svg="http://www.w3.org/2000/svg"    xmlns="http://www.w3.org/2000/svg"    xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"    xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"    width="264.21545"    height="246.4431"    id="svg2"    version="1.1"    inkscape:version="0.48.3.1 r9886"    sodipodi:docname="Nowy dokument 1">   <defs      id="defs4">     <inkscape:path-effect        effect="skeletal"        id="path-effect3024"        is_visible="true"        pattern="M 0,0 1,0"        copytype="single_stretched"        prop_scale="1"        scale_y_rel="false"        spacing="0"        normal_offset="0"        tang_offset="0"        prop_units="false"        vertical_pattern="false"        fuse_tolerance="0" />   </defs>   <sodipodi:namedview      id="base"      pagecolor="#ffffff"      bordercolor="#666666"      borderopacity="1.0"      inkscape:pageopacity="0.0"      inkscape:pageshadow="2"      inkscape:zoom="0.98994949"      inkscape:cx="221.12862"      inkscape:cy="119.76751"      inkscape:document-units="px"      inkscape:current-layer="layer1"      showgrid="false"      fit-margin-top="0"      fit-margin-left="0"      fit-margin-right="0"      fit-margin-bottom="0"      inkscape:window-width="1366"      inkscape:window-height="742"      inkscape:window-x="0"      inkscape:window-y="0"      inkscape:window-maximized="1" />   <metadata      id="metadata7">     <rdf:RDF>       <cc:Work          rdf:about="">         <dc:format>image/svg+xml</dc:format>         <dc:type            rdf:resource="http://purl.org/dc/dcmitype/StillImage" />         <dc:title></dc:title>       </cc:Work>     </rdf:RDF>   </metadata>   <g      inkscape:label="Layer 1"      inkscape:groupmode="layer"      id="layer1"      transform="translate(-138.93756,-100.37438)">     <rect        style="fill:#fffc9b;fill-opacity:1;stroke:none"        id="rect3060"        width="264.21545"        height="246.4431"        x="138.93756"        y="100.37438" />     <path        style="fill:#ffffff;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"        d="m 237.76786,223.61218 c 2.60139,-1.23318 4.98364,-3.15786 6.18367,-5.77471 0.97086,-2.11711 1.0683,-4.60323 0.33366,-6.81344 -1.61728,-4.86565 -6.93112,-7.95029 -12.05576,-7.78207 0,0 0,0 0,0 -4.68029,0.5736 -9.51738,2.22425 -12.48897,5.88537 0,0 0,0 0,0 -2.07073,2.55122 -2.92273,6.10297 -2.00328,9.25753 0.91912,3.1534 3.52493,5.70018 6.62745,6.77863 4.35624,1.51424 9.23585,0.42421 13.40323,-1.55131 z"        id="path3022"        inkscape:path-effect="#path-effect3024"        inkscape:original-d="m 237.76786,223.61218 c 12.68124,-6.01148 6.54444,-20.76684 -5.53843,-20.37022 -24.46684,2.99859 -16.0253,30.59239 5.53843,20.37022 z"        inkscape:connector-curvature="0"        sodipodi:nodetypes="scs" />     <path        style="fill:#ffffff;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"        d="m 308.28593,182.62084 c -39.42886,18.82528 -3.35299,28.80133 17.10946,14.2684 5.37429,-3.81695 -9.0998,-14.44718 -17.10946,-14.2684 z"        id="path3046"        inkscape:connector-curvature="0"        sodipodi:nodetypes="csc" />     <path        style="fill:#000000;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"        d="m 232.17725,209.20048 c -1.59796,0.0788 -2.935,0.71928 -4.26158,1.51523 -7.14662,4.28797 -0.57097,10.28132 5.74524,8.17592 5.88268,-1.96089 5.67656,-11.18287 -1.48366,-9.69115 z"        id="path3050"        inkscape:connector-curvature="0" />     <path        style="fill:#000000;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"        d="m 308.47533,187.60847 c -3.56136,0.30275 -6.0068,2.60656 -7.26047,5.11389 -4.43739,8.87478 14.66024,7.93089 11.36422,-1.95717 -0.73785,-2.21353 -2.25818,-2.75551 -4.10375,-3.15672 z"        id="path3058"        inkscape:connector-curvature="0" />     <path        style="fill:#ffffff;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"        d="m 283.21429,290.21932 c 1.8689,-2.87387 5.33223,-3.55648 8.25893,-5.3125 3.3831,-2.02986 8.41144,-2.94643 12.41071,-2.94643 12.53189,0 -13.46198,17.86915 -20.66964,8.25893 z"        id="path3840"        inkscape:connector-curvature="0" />     <path        style="fill:#ffffff;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"        d="m 296.20536,290.75504 c -26.84581,5.98194 -2.25344,15.50527 5.13393,10.58035 3.78743,-2.52495 5.74633,-4.80568 8.61607,-8.39285 5.39485,-6.74356 -11.79539,-2.24676 -13.92857,-2.1875"        id="path3838"        inkscape:connector-curvature="0" />   </g> </svg>'

			var c = document.getElementById('draw');
			var ctx = c.getContext('2d');


			now = then = Date.now();

			function setDelta() {
				now = Date.now();
				delta = (now - then) / 1000; // seconds since last frame
				then = now;
			}

			// Handle keyboard controls
			var keysDown = {};

			addEventListener("keydown", function (e) {
				keysDown[e.keyCode] = true;
			}, false);

			addEventListener("keyup", function (e) {
				delete keysDown[e.keyCode];
			}, false);

			var nextBullet = 1.6
			var toBullet = 2

			bullets = []

			player = {x: 616, y: 120}

			fucked = false

			function update() {
				setDelta()
				toBullet -= delta
				if(toBullet <= 0) {
					toBullet = nextBullet
					nextBullet -= 0.1
					bullets.push({x: 616, y: 360, dx: 2.0 * Math.random() - 1.0, dy: 2.0 * Math.random() - 1.0 })
				}
				ctx.fillStyle = "black"
				ctx.font = "bold 14px sans-serif";
				for(var i = 0; i < bullets.length; i++)
				{
					bullets[i].x += delta * 110.0 * bullets[i].dx
					bullets[i].y += delta * 110.0 * bullets[i].dy

					ctx.fillText("2.0", bullets[i].x, bullets[i].y);

					if(bullets[i].x > player.x && bullets[i].x < player.x + 16 && bullets[i].y > player.y && bullets[i].y < player.y + 16) {

						ctx.fillStyle = "pink"
						ctx.font = "bold 120px sans-serif";

						ctx.fillText("Fuck!", 300, 200);
						fucked = true;
					}
				}

				ctx.fillStyle = "red"
				ctx.font = "bold 14px sans-serif";
				if(keysDown[65])
				{
					player.x -= delta * 60.0;
				}
				else if(keysDown[68])
				{
					player.x += delta * 60.0;
				}

				if(keysDown[87])
				{
					player.y -= delta * 60.0;
				}
				else if(keysDown[83])
				{
					player.y += delta * 60.0;
				}

				ctx.fillRect(player.x, player.y, 16, 16)
				ctx.strokeRect(player.x, player.y, 16, 16)

				if(!fucked) {
					window.requestAnimationFrame(update);
				}
				else {
					ctx.fillStyle = "red"
					ctx.font = "bold 120px sans-serif";

					ctx.fillText("Fuck!", 300, 200);
				}
			}


			window.requestAnimationFrame(update);


			ctx.drawSvg(wat, 500, 200, 200, 200);

		</script>
	</body>
</html>
